# UNION in MySQL

> DB 문제를 풀며 이런 의문이 들었다. **기존의 테이블에 기록되어 있는 레코드 외에 동일한 성격의 레코드를 추가 할 수 있는가? 물론 조회(SELECT)할 때 말이다.**

> 예시로 `입양 시각 구하기`<https://school.programmers.co.kr/learn/courses/30/lessons/59413>

- 바로 검색해봤다. 솔직히 어떻게 검색해야 할 지 감도 오지 않았지만, 우리에겐 구글이 있다. 개떡같이 검색해도 연관 검색어를 타고 타고 들어가다 보면 원하는 키워드가 나온다. 
- 그리고 찾아낸 `UNION` 연산자
  - 이 연산자는 기존에 JOIN 공부를 할 때 FULL OUTER JOIN 때문에 공부한 적이 있지만, 그때는 '합치는 연산자'구나, 정도로 넘어간 연산자였다.

## UNION operator
여러 테이블에 존재하는 같은 성격의 값을 한번의 쿼리로 추출할 수 있도록 돕는 연산자

- 대응하는 필드의 이름이 같아야 함.
  - 같지 않다면 AS 사용하여 같게 만들어야 함.
- 대응되는 각 필드의 타입이 같아야 함

- UNION ALL의 경우 중복을 허용한 채로 합친다.

> 하지만 이것만으론 부족하다. UNION 하기 위한 **새로운 테이블**이 필요하기 때문이다.

- 이때는 정답을 보는 꼼수를 썼다. 가장 많이 보이는 키워드는 `WITH RECURSIVE`였다.
  - 코드를 다 본 건 아니다. 맹세한다. 키워드만 훑었다.

- 그렇다면 WITH RECURSIVE가 뭔지 조사할 필요가 있다.

## WITH RECURSIVE

WITH 구문은 메모리 상에 가상의 테이블을 저장할 때 사용됨. <BR>
RECURSIVE의 여부에 따라 재귀 또는 비재귀 두 가지 방법으로 사용 가능함. <BR>
WITH RECURSIVE 구문은 가상 테이블을 생성하면서 가상 테이블 자신의 값을 참조하여 값을 결정할 때 사용
```SQL
WITH [RECURSIVE] table_name AS(
  SELECT -- 비반복문. 무조건 필수 (첫번째 루프에서만 실행됨)
  [UNION ALL] -- RECURSIVE 사용 시 필수. 다음에 이어붙어야 할 때 사용
  SELECT -- 반복문(읽어 올 때마다 행의 위치가 기억되어 다음번 읽어 올 때 다음 행으로 이동함)
  [WHERE] -- RECRUSVIE 사용 시 필수. 정지 조건 필요할 때 사용.
)
```
  - 재귀 쿼리 설명이 친절한 맛집 블로그 <https://inpa.tistory.com/entry/MYSQL-%F0%9F%93%9A-RECURSIVE-%EC%9E%AC%EA%B7%80-%EC%BF%BC%EB%A6%AC>
    - 심지어 지금 내가 푸는 문제를 설명해준다.
  - 가상의 테이블을 구성하면서 그 자신을 참조하여 값을 결정할 때 유용함.
